syntax = "proto3";

package turing;

option java_outer_classname = "TuringResultLogProto";
option go_package = "github.com/gojek/turing";

import "google/protobuf/timestamp.proto";

message Request {
    // The header from the incoming request to the Turing router. The map value is a comma-delimited string.
    map<string,string> header = 1;

    // The JSON body of the request to the Turing router, UTF-8-encoded
    string body = 2;
}

message Response {
    // The JSON response from a Turing component (Enricher / Experiment Engine / Router / Ensembler), UTF-8-encoded.
    string response = 1;

    // The error from a Turing component, when a successful response is not received.
    string error = 2;

    // The response header from a Turing component (Enricher / Experiment Engine / Router / Ensembler); the map value
    // is a comma-delimited string.
    map<string,string> header = 3;
}

// key
message TuringResultLogKey {
    // The unique request id generated by Turing, for every incoming request to the Turing router
    string turing_req_id = 1;

    // The time at which the final response from the Turing router is generated
    google.protobuf.Timestamp event_timestamp = 2;
}

// message
message TuringResultLogMessage {
    // The unique request id generated by Turing, for every incoming request to the Turing router
    string turing_req_id = 1;

    // The time at which the final response from the Turing router is generated
    google.protobuf.Timestamp event_timestamp = 2;

    // The version of the router deployed. This corresponds to the name and version of the router deployed from the Turing app.
    // Format: {router_name}-{router_version}.{project_name}
    string router_version = 3;

    // The original request to the Turing router
    Request request = 4;

    // The response from the Experiment engine, if configured
    Response experiment = 5;

    // The response from the Enricher, if configured
    Response enricher = 6;

    // The response from the routes
    Response router = 7;

    // The response from the Enricher, if configured
    Response ensembler = 8;
}
