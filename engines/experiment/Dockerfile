FROM alpine:3.15

ENV TURING_USER "turing"
ENV TURING_USER_GROUP "app"

RUN addgroup -S ${TURING_USER_GROUP} \
    && adduser -S ${TURING_USER} -G ${TURING_USER_GROUP} -H

ARG PLUGIN_BINARY
ARG PLUGIN_NAME

ENV PLUGIN_NAME ${PLUGIN_NAME}
ENV PLUGINS_DIR "/app/plugins"

ADD ${PLUGIN_BINARY} /go/bin/${PLUGIN_NAME}

RUN chown ${TURING_USER}:${TURING_USER_GROUP} /go/bin/${PLUGIN_NAME}

ENTRYPOINT cp "/go/bin/${PLUGIN_NAME}" "${PLUGINS_DIR}/${PLUGIN_NAME}"